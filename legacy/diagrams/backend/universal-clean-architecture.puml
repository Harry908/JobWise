@startuml Universal Clean Architecture
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title JobWise Backend Architecture - Current Implementation Status (F1-F6 Complete)

Person(user, "Job Seeker", "Mobile app user")

System_Boundary(jobwise, "JobWise Universal System") {
    Container(mobile_app, "Flutter Mobile App", "Flutter/Dart", "Cross-platform user interface")
    
    Container_Boundary(backend, "Universal FastAPI Backend") {
        Container(api_gateway, "API Gateway", "FastAPI Router", "âœ… CORS, rate limiting, health checks")
        
        Container_Boundary(presentation, "Presentation Layer") {
            Container(auth_api, "Auth API", "FastAPI", "âœ… F3 Complete: JWT auth, register/login")
            Container(profile_api, "Profile API", "FastAPI", "âœ… F4 Complete: Master resume CRUD")
            Container(job_api, "Job API", "FastAPI", "âœ… F5 Complete: Job discovery, search")
            Container(job_desc_api, "Job Description API", "FastAPI", "âœ… F6 Complete: Custom job descriptions")
            Container(generation_api, "Generation API", "FastAPI", "ðŸš§ F7 Structure: AI generation endpoints")
            Container(document_api, "Document API", "FastAPI", "ðŸš§ F8 Structure: Document management")
        }
        
        Container_Boundary(application, "Application Services") {
            Container(auth_service, "Auth Service", "Python", "âœ… JWT token management, password hashing")
            Container(profile_service, "Profile Service", "Python", "âœ… Profile business logic, validation")
            Container(job_service, "Job Service", "Python", "âœ… Static job search, filtering")
            Container(job_desc_service, "Job Description Service", "Python", "âœ… Custom job CRUD, keyword extraction")
            Container(generation_service, "Generation Service", "Python", "ðŸš§ Mock AI orchestration ready")
            Container(document_service, "Document Service", "Python", "ðŸš§ Document handling ready")
        }
        
        Container_Boundary(domain_core, "Domain Core") {
            Container(entities, "Domain Entities", "Python", "âœ… Complete: User, Profile, Job, Generation")
            Container(value_objects, "Value Objects", "Python", "âœ… Personal info, experience, education, skills")
            Container(ports, "Service Ports", "Python", "âœ… LLM, PDF, cache, storage interfaces")
            Container(orchestrator, "AI Orchestrator", "Python", "ðŸš§ 5-stage pipeline structure ready")
        }
        
        Container_Boundary(infrastructure, "Infrastructure Layer") {
            Container(database_layer, "Database Layer", "SQLAlchemy Async", "âœ… Complete: Models, repositories, single schema")
            Container(auth_middleware, "Auth Middleware", "JWT", "âœ… Token validation, user context")
            Container(cache_adapters, "Cache Adapters", "Redis/Memory", "ðŸš§ Structure ready")
            Container(storage_adapters, "Storage Adapters", "Local/Cloud", "ðŸš§ Structure ready")
        }
        
        Container_Boundary(ai_infrastructure, "AI Infrastructure (F7-F8 Ready)") {
            Container(llm_adapters, "LLM Adapters", "OpenAI/Claude/Groq", "ðŸš§ Universal adapter pattern")
            Container(pdf_adapters, "PDF Adapters", "ReportLab/WeasyPrint", "ðŸš§ Export system ready")
            Container(prompt_manager, "Prompt Manager", "Template System", "ðŸš§ 5-stage prompts")
            Container(quality_validator, "Quality Validator", "ATS Compliance", "ðŸš§ Validation pipeline")
        }
    }
    
    ContainerDb(database, "Database", "SQLite/PostgreSQL", "âœ… Single schema approach, all tables created")
    Container(cache_store, "Cache Store", "Redis/Memory", "ðŸš§ Performance optimization ready")
}

System_Boundary(external_services, "External Service Providers") {
    System_Ext(openai_api, "OpenAI API", "GPT models")
    System_Ext(claude_api, "Anthropic API", "Claude models") 
    System_Ext(groq_api, "Groq API", "Ultra-fast LLM inference")
    
    System_Ext(static_jobs, "Static Job Data", "JSON files with 100+ jobs")
}

' User interactions
Rel(user, mobile_app, "Uses", "Mobile UI")
Rel(mobile_app, api_gateway, "API calls", "REST/HTTPS")

' API Gateway routing (F1-F6 Complete)
Rel(api_gateway, auth_api, "âœ… Routes auth", "JWT tokens working")
Rel(api_gateway, profile_api, "âœ… Routes profiles", "Full CRUD working") 
Rel(api_gateway, job_api, "âœ… Routes jobs", "Search/filter working")
Rel(api_gateway, job_desc_api, "âœ… Routes custom jobs", "CRUD complete")
Rel(api_gateway, generation_api, "ðŸš§ Routes generation", "Structure ready")
Rel(api_gateway, document_api, "ðŸš§ Routes documents", "Structure ready")

' Application service dependencies
Rel(auth_api, auth_service, "âœ… Implemented")
Rel(profile_api, profile_service, "âœ… Implemented")
Rel(job_api, job_service, "âœ… Implemented")
Rel(job_desc_api, job_desc_service, "âœ… Implemented")
Rel(generation_api, generation_service, "ðŸš§ Structure ready")
Rel(document_api, document_service, "ðŸš§ Structure ready")

' Domain core relationships
Rel(generation_service, orchestrator, "ðŸš§ Will orchestrate via")
Rel(orchestrator, ports, "ðŸš§ Will use abstract ports")
Rel(orchestrator, entities, "âœ… Operates on")

' Database layer (Complete)
Rel(auth_service, database_layer, "âœ… User auth data")
Rel(profile_service, database_layer, "âœ… Profile CRUD")
Rel(job_service, database_layer, "âœ… Job search")
Rel(job_desc_service, database_layer, "âœ… Custom job CRUD")
Rel(generation_service, database_layer, "ðŸš§ Generation tracking")
Rel(document_service, database_layer, "ðŸš§ Document storage")

Rel(database_layer, database, "âœ… Async connections")

' AI Infrastructure connections (Ready for F7-F8)
Rel(orchestrator, llm_adapters, "ðŸš§ Will use for generation")
Rel(document_service, pdf_adapters, "ðŸš§ Will use for export")
Rel(orchestrator, prompt_manager, "ðŸš§ Will use for prompts")
Rel(orchestrator, quality_validator, "ðŸš§ Will use for validation")

' External service integrations
Rel(job_service, static_jobs, "âœ… Loads job data", "100+ jobs")
Rel(llm_adapters, openai_api, "ðŸš§ Will call", "HTTPS")
Rel(llm_adapters, claude_api, "ðŸš§ Will call", "HTTPS")
Rel(llm_adapters, groq_api, "ðŸš§ Will call", "HTTPS")

' Current implementation status notes
note top of auth_api
âœ… F3 Authentication Complete:
â€¢ JWT token management working
â€¢ User registration/login
â€¢ Password security (bcrypt)
â€¢ 13/13 tests passing (100%)
â€¢ Middleware protection active
end note

note top of profile_api
âœ… F4 Profile Management Complete:
â€¢ Master profile CRUD operations
â€¢ Experience/education/project management
â€¢ Profile analytics endpoints
â€¢ Comprehensive value objects
â€¢ Repository pattern with async support
end note

note top of job_api
âœ… F5 Job Discovery Complete:
â€¢ Static job data (100+ jobs)
â€¢ Search and filtering working
â€¢ Job seeding script
â€¢ 6/6 tests passing
â€¢ Performance optimized
end note

note top of job_desc_api
âœ… F6 Custom Job Descriptions Complete:
â€¢ User-owned job descriptions
â€¢ Full CRUD operations
â€¢ Keyword parsing/extraction
â€¢ Status management (draft/active/archived)
â€¢ User ownership validation
end note

note top of database_layer
âœ… F2 Database Foundation Complete:
â€¢ SQLAlchemy 2.0 async implementation
â€¢ Single schema approach (schema.py)
â€¢ All entity models with relationships
â€¢ Repository pattern with full CRUD
â€¢ Connection pooling and health checks
â€¢ API-consistent table naming
end note

note right of generation_api
ðŸš§ F7 Structure Ready:
â€¢ Generation entity models in place
â€¢ 5-stage pipeline scaffolding
â€¢ Universal LLM service framework
â€¢ AI orchestrator architecture
â€¢ Mock generation endpoints ready
end note

note right of document_api
ðŸš§ F8 Structure Ready:
â€¢ Document storage entity
â€¢ PDF generation adapters
â€¢ File management support
â€¢ Export system framework
â€¢ Download endpoints structure
end note

@enduml