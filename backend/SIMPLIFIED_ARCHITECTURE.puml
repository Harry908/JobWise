@startuml JobWise Simplified Architecture

title JobWise Backend - Clean Architecture with Adapters (Sprint 2)

' Define colors
!define LAYER_API #E3F2FD
!define LAYER_SERVICE #FFF9C4
!define LAYER_DOMAIN #E1BEE7
!define LAYER_INFRA #C8E6C9
!define LAYER_DB #FFCCBC

' ============================================================================
' Presentation Layer - API Endpoints
' ============================================================================
package "Presentation Layer\n(app/presentation/api/)" as presentation LAYER_API {
    component [auth.py] as auth_api
    component [profiles.py] as profile_api
    component [jobs.py] as job_api
    component [job_descriptions.py] as job_desc_api
    component [generation.py] as gen_api
    component [documents.py] as doc_api
}

note top of presentation
  **HTTP Endpoints**
  - Request validation (Pydantic DTOs)
  - JWT authentication
  - Error handling
  - OpenAPI docs
end note

' ============================================================================
' Application Layer - Business Logic
' ============================================================================
package "Application Layer\n(app/application/)" as application LAYER_SERVICE {
    package "services/" {
        component [AuthService] as auth_svc
        component [ProfileService] as profile_svc
        component [JobService] as job_svc
        component [GenerationService] as gen_svc
        component [DocumentService] as doc_svc
    }

    package "dtos/" {
        component [Request/Response\nDTOs] as dtos
    }
}

note top of application
  **Business Logic**
  - Use domain ports (interfaces)
  - Orchestrate workflows
  - Validate business rules
end note

' ============================================================================
' Domain Layer - Core Business Logic
' ============================================================================
package "Domain Layer\n(app/domain/)" as domain LAYER_DOMAIN {
    package "entities/" {
        component [User] as user_entity
        component [Profile] as profile_entity
        component [Job] as job_entity
        component [Generation] as gen_entity
        component [Document] as doc_entity
    }

    package "value_objects/" {
        component [Experience] as exp_vo
        component [Education] as edu_vo
        component [Skills] as skill_vo
    }

    package "ports/" {
        interface "ILLMService" as llm_port
        interface "IPDFExporter" as pdf_port
        interface "IJobRepository" as job_repo_port
        interface "IProfileRepository" as profile_repo_port
        interface "IGenerationRepository" as gen_repo_port
    }
}

note top of domain
  **Core Domain**
  - Pure business entities
  - No external dependencies
  - Ports define contracts
end note

' ============================================================================
' Infrastructure Layer - Implementations
' ============================================================================
package "Infrastructure Layer\n(app/infrastructure/)" as infrastructure LAYER_INFRA {
    package "adapters/" {
        component [MockLLMAdapter\n(Sprint 2)] as mock_llm
        component [ReportLabAdapter\n(Sprint 2)] as reportlab

        note right of mock_llm
          Real adapters later:
          - OpenAIAdapter (Sprint 3)
          - ClaudeAdapter (Sprint 4)
        end note
    }

    package "repositories/" {
        component [ProfileRepository] as profile_repo
        component [JobRepository] as job_repo
        component [GenerationRepository] as gen_repo
        component [DocumentRepository] as doc_repo
    }

    package "database/" {
        component [models.py\nSQLAlchemy Models] as models
        component [connection.py] as conn
    }
}

note top of infrastructure
  **Adapter Implementations**
  - Implement domain ports
  - Database access
  - External services
end note

' ============================================================================
' Database
' ============================================================================
database "PostgreSQL/SQLite" as database LAYER_DB {
    storage "users"
    storage "profiles"
    storage "experiences"
    storage "education"
    storage "skills"
    storage "jobs"
    storage "generations"
    storage "documents"
}

' ============================================================================
' Dependencies (following Clean Architecture rules)
' ============================================================================

' Presentation -> Application
auth_api --> auth_svc
profile_api --> profile_svc
job_api --> job_svc
gen_api --> gen_svc
doc_api --> doc_svc

' Application -> Domain (uses ports)
auth_svc --> user_entity
profile_svc --> profile_entity
job_svc --> job_entity
gen_svc --> gen_entity
gen_svc ..> llm_port : depends on
gen_svc ..> gen_repo_port : depends on
gen_svc ..> profile_repo_port : depends on
doc_svc --> doc_entity
doc_svc ..> pdf_port : depends on

' Infrastructure implements Domain ports
mock_llm ..|> llm_port : implements
reportlab ..|> pdf_port : implements
profile_repo ..|> profile_repo_port : implements
job_repo ..|> job_repo_port : implements
gen_repo ..|> gen_repo_port : implements

' Infrastructure -> Database
profile_repo --> models
job_repo --> models
gen_repo --> models
doc_repo --> models
models --> database

' ============================================================================
' Dependency Injection Flow
' ============================================================================
note bottom of infrastructure
  **Dependency Injection:**

  API layer receives concrete implementations:
  ```python
  # In API endpoint
  def get_generation_service(
      llm_service: ILLMService = Depends(get_llm_service),
      gen_repo: IGenerationRepository = Depends(get_gen_repo)
  ) -> GenerationService:
      return GenerationService(llm_service, gen_repo)
  ```

  **Dependencies injected in core/dependencies.py:**
  - For Sprint 2: MockLLMAdapter
  - For Sprint 3+: OpenAIAdapter or ClaudeAdapter
  - Switch implementations without changing service code
end note

' ============================================================================
' Current Implementation Status
' ============================================================================
note right of gen_api
  **Sprint 2 Focus:**

  **Generation Pipeline (Mock):**
  1. Job Analysis
  2. Profile Compilation
  3. Content Generation
  4. Quality Validation
  5. Export Preparation

  **Document Export:**
  - Text format (.txt)
  - ReportLab for PDF (future)

  **Keep Simple:**
  - ONE LLM adapter (Mock)
  - ONE PDF adapter (ReportLab)
  - No service factory yet
  - No circuit breakers yet
  - Add when needed
end note

' ============================================================================
' Folder Structure
' ============================================================================
note left of domain
  **Simplified Folder Structure:**

  app/
  ├── presentation/api/
  ├── application/
  │   ├── services/
  │   └── dtos/
  ├── domain/
  │   ├── entities/
  │   ├── value_objects/
  │   └── ports/
  └── infrastructure/
      ├── adapters/
      │   ├── llm/
      │   └── pdf/
      ├── repositories/
      └── database/

  **Removed:**
  - application/use_cases/ (redundant)
  - domain/services/ (move to application)
  - infrastructure/core/ (service factory, etc.)
  - infrastructure/ai/ (over-engineered)
  - Empty adapter stubs
end note

@enduml
