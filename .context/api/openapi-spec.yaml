openapi: 3.0.3
info:
  title: JobWise API
  description: |
    JobWise AI-powered job application assistant API.
    
    ## Features
    - Master resume profile management
    - Job discovery and management
    - AI-powered resume and cover letter generation (2-stage pipeline)
    - Document management and PDF generation
    - Real-time generation progress tracking
    
    ## Authentication
    - Development: API Key authentication
    - Production: JWT Bearer tokens with OAuth 2.0
    
    ## Rate Limiting
    - AI Generation: 10 requests/hour per user
    - Other endpoints: 100 requests/minute per user
    
  version: 1.0.0
  contact:
    name: JobWise Development Team
    email: dev@jobwise.ai
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000/api/v1
    description: Development server
  - url: https://api.jobwise.ai/v1
    description: Production server

security:
  - bearerAuth: []

paths:
  # Health Check
  /health:
    get:
      tags:
        - System
      summary: Health check endpoint
      description: Check API health and dependencies status
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "healthy"
                timestamp: "2024-10-18T10:30:00Z"
                version: "1.0.0"
                dependencies:
                  database: "connected"
                  redis: "connected"
                  openai: "available"

  # Authentication
  /auth/login:
    post:
      tags:
        - Authentication
      summary: User authentication
      description: Authenticate user and return access token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: "john.doe@example.com"
              password: "secure_password123"
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # Master Resume Profiles
  /profiles:
    get:
      tags:
        - Profiles
      summary: List user profiles
      description: Get all resume profiles for authenticated user
      parameters:
        - name: limit
          in: query
          description: Maximum number of profiles to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          description: Number of profiles to skip
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Profiles retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Profiles
      summary: Create new profile
      description: Create a new master resume profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProfileDTO'
            example:
              personal_info:
                full_name: "John Doe"
                email: "john.doe@example.com"
                phone: "+1-555-123-4567"
                location: "Seattle, WA"
                linkedin: "https://linkedin.com/in/johndoe"
                github: "https://github.com/johndoe"
              professional_summary: "Experienced software engineer with 5+ years in full-stack development"
              experiences:
                - title: "Senior Software Engineer"
                  company: "Tech Corp"
                  location: "Seattle, WA"
                  start_date: "2021-01-01"
                  end_date: null
                  is_current: true
                  description: "Lead development of microservices architecture"
                  achievements:
                    - "Improved system performance by 40%"
                    - "Led team of 4 developers"
                    - "Reduced deployment time from 2 hours to 15 minutes"
              education:
                - institution: "University of Washington"
                  degree: "Bachelor of Science"
                  field_of_study: "Computer Science"
                  start_date: "2015-09-01"
                  end_date: "2019-06-15"
                  gpa: 3.8
              skills:
                technical:
                  - "Python"
                  - "FastAPI"
                  - "React"
                  - "PostgreSQL"
                  - "AWS"
                soft:
                  - "Leadership"
                  - "Problem Solving"
                  - "Communication"
                languages:
                  - name: "English"
                    proficiency: "Native"
                  - name: "Spanish"
                    proficiency: "Conversational"
                certifications:
                  - name: "AWS Solutions Architect"
                    issuer: "Amazon Web Services"
                    date_obtained: "2023-03-15"
                    expiry_date: "2026-03-15"
      responses:
        '201':
          description: Profile created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileDTO'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /profiles/{profile_id}:
    get:
      tags:
        - Profiles
      summary: Get profile by ID
      description: Retrieve specific profile details
      parameters:
        - $ref: '#/components/parameters/ProfileId'
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileDTO'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'

    put:
      tags:
        - Profiles
      summary: Update profile
      description: Update existing profile (full replacement)
      parameters:
        - $ref: '#/components/parameters/ProfileId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileDTO'
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileDTO'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'

    delete:
      tags:
        - Profiles
      summary: Delete profile
      description: Permanently delete profile and all associated data
      parameters:
        - $ref: '#/components/parameters/ProfileId'
      responses:
        '204':
          description: Profile deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /profiles/{profile_id}/history:
    get:
      tags:
        - Profiles
      summary: Get profile history
      description: Retrieve version history for profile
      parameters:
        - $ref: '#/components/parameters/ProfileId'
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: Profile history retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileHistoryResponse'

  # Job Discovery and Management
  /jobs:
    get:
      tags:
        - Jobs
      summary: Search and browse jobs
      description: Search job listings with filtering and pagination
      parameters:
        - name: query
          in: query
          description: Job search keywords
          schema:
            type: string
          example: "software engineer python"
        - name: location
          in: query
          description: Job location
          schema:
            type: string
          example: "Seattle, WA"
        - name: experience_level
          in: query
          description: Experience level filter
          schema:
            type: string
            enum: [entry, mid, senior, lead, executive]
        - name: job_type
          in: query
          description: Job type filter
          schema:
            type: string
            enum: [full_time, part_time, contract, freelance, internship]
        - name: remote
          in: query
          description: Remote work filter
          schema:
            type: boolean
        - name: salary_min
          in: query
          description: Minimum salary filter
          schema:
            type: integer
            minimum: 0
        - name: salary_max
          in: query
          description: Maximum salary filter
          schema:
            type: integer
            minimum: 0
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Jobs retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobSearchResponse'
              example:
                jobs:
                  - id: "job_123"
                    title: "Senior Python Developer"
                    company: "TechCorp Inc"
                    location: "Seattle, WA"
                    remote: true
                    job_type: "full_time"
                    experience_level: "senior"
                    salary_range:
                      min: 120000
                      max: 180000
                      currency: "USD"
                    posted_date: "2024-10-15T09:00:00Z"
                    description: "We are looking for a Senior Python Developer..."
                    requirements:
                      - "5+ years Python experience"
                      - "FastAPI or Django knowledge"
                      - "AWS cloud experience"
                    benefits:
                      - "Health insurance"
                      - "401k matching"
                      - "Remote work"
                    application_url: "https://techcorp.com/jobs/senior-python-dev"
                pagination:
                  total: 1250
                  limit: 20
                  offset: 0
                  has_next: true
        '400':
          $ref: '#/components/responses/BadRequest'

  /jobs/{job_id}:
    get:
      tags:
        - Jobs
      summary: Get job details
      description: Retrieve detailed information about specific job
      parameters:
        - $ref: '#/components/parameters/JobId'
      responses:
        '200':
          description: Job details retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  # Saved Jobs
  /saved-jobs:
    get:
      tags:
        - Saved Jobs
      summary: Get saved jobs
      description: Retrieve user's saved jobs with status tracking
      parameters:
        - name: status
          in: query
          description: Filter by application status
          schema:
            type: string
            enum: [interested, applied, interviewing, offered, rejected, withdrawn]
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Saved jobs retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SavedJobListResponse'

    post:
      tags:
        - Saved Jobs
      summary: Save a job
      description: Save job for later reference and application tracking
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveJobRequest'
            example:
              job_id: "job_123"
              notes: "Great company culture, competitive salary"
              status: "interested"
      responses:
        '201':
          description: Job saved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SavedJobResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Job already saved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /saved-jobs/{saved_job_id}:
    get:
      tags:
        - Saved Jobs
      summary: Get saved job details
      parameters:
        - $ref: '#/components/parameters/SavedJobId'
      responses:
        '200':
          description: Saved job retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SavedJobResponse'

    put:
      tags:
        - Saved Jobs
      summary: Update saved job
      description: Update notes and status for saved job
      parameters:
        - $ref: '#/components/parameters/SavedJobId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSavedJobRequest'
      responses:
        '200':
          description: Saved job updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SavedJobResponse'

    delete:
      tags:
        - Saved Jobs
      summary: Remove saved job
      parameters:
        - $ref: '#/components/parameters/SavedJobId'
      responses:
        '204':
          description: Saved job removed

  # AI Generation (Priority Feature)
  /generations/resume:
    post:
      tags:
        - AI Generation
      summary: Generate tailored resume
      description: |
        Generate AI-tailored resume using 2-stage pipeline:
        1. Job Analysis - Extract keywords and requirements (1500 tokens)
        2. Profile Compilation - Score and rank profile content (2000 tokens)  
        3. Document Generation - Create tailored resume content (3000 tokens)
        4. Quality Validation - Verify ATS compliance and factuality (1500 tokens)
        5. PDF Export - Generate professional PDF (0 tokens)
        
        Total token budget: 8000 tokens per generation
        Performance target: <30s (p50), <60s (p95)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResumeGenerationRequest'
            example:
              profile_id: "profile_456"
              job_id: "job_123"
              options:
                template: "modern"
                length: "one_page"
                focus_areas:
                  - "backend_development"
                  - "leadership"
                include_cover_letter: true
                custom_instructions: "Emphasize cloud architecture experience"
      responses:
        '201':
          description: Resume generation started
          headers:
            Location:
              description: URL to check generation status
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerationResponse'
              example:
                generation_id: "gen_789"
                status: "pending"
                estimated_completion: "2024-10-18T10:32:00Z"
                progress:
                  current_stage: 0
                  total_stages: 2
                  percentage: 0
                profile_id: "profile_456"
                job_id: "job_123"
                created_at: "2024-10-18T10:30:00Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "rate_limit_exceeded"
                message: "Generation rate limit exceeded. Try again in 1 hour."
                retry_after: 3600

  /generations/cover-letter:
    post:
      tags:
        - AI Generation
      summary: Generate tailored cover letter
      description: Generate AI-tailored cover letter for specific job
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CoverLetterGenerationRequest'
      responses:
        '201':
          description: Cover letter generation started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerationResponse'

  /generations/{generation_id}:
    get:
      tags:
        - AI Generation
      summary: Get generation status
      description: Check status and progress of AI generation process
      parameters:
        - $ref: '#/components/parameters/GenerationId'
      responses:
        '200':
          description: Generation status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GenerationStatusResponse'
              examples:
                in_progress:
                  summary: Generation in progress
                  value:
                    generation_id: "gen_789"
                    status: "generating"
                    progress:
                      current_stage: 1
                      total_stages: 2
                      percentage: 40
                      stage_name: "Analysis & Matching"
                      stage_description: "Analyzing job and matching with your profile content"
                    tokens_used: 3500
                    estimated_completion: "2024-10-18T10:32:00Z"
                    created_at: "2024-10-18T10:30:00Z"
                    updated_at: "2024-10-18T10:31:00Z"
                completed:
                  summary: Generation completed
                  value:
                    generation_id: "gen_789"
                    status: "completed"
                    progress:
                      current_stage: 2
                      total_stages: 2
                      percentage: 100
                      stage_name: "Generation & Validation"
                      stage_description: "Completed"
                    result:
                      document_id: "doc_101"
                      ats_score: 0.87
                      match_percentage: 82
                      keyword_coverage: 0.91
                      pdf_url: "https://api.jobwise.ai/documents/doc_101/download"
                    tokens_used: 7850
                    generation_time: 28.5
                    created_at: "2024-10-18T10:30:00Z"
                    completed_at: "2024-10-18T10:31:28Z"
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - AI Generation
      summary: Cancel generation
      description: Cancel ongoing AI generation process
      parameters:
        - $ref: '#/components/parameters/GenerationId'
      responses:
        '204':
          description: Generation cancelled successfully
        '400':
          description: Cannot cancel completed generation
        '404':
          $ref: '#/components/responses/NotFound'

  # Document Management
  /documents:
    get:
      tags:
        - Documents
      summary: List generated documents
      description: Retrieve user's generated documents with filtering
      parameters:
        - name: document_type
          in: query
          description: Filter by document type
          schema:
            type: string
            enum: [resume, cover_letter]
        - name: job_id
          in: query
          description: Filter by associated job
          schema:
            type: string
        - name: profile_id
          in: query
          description: Filter by source profile
          schema:
            type: string
        - name: created_after
          in: query
          description: Filter by creation date (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Documents retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentListResponse'

  /documents/{document_id}:
    get:
      tags:
        - Documents
      summary: Get document details
      description: Retrieve detailed information about generated document
      parameters:
        - $ref: '#/components/parameters/DocumentId'
      responses:
        '200':
          description: Document retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocumentResponse'
              example:
                id: "doc_101"
                document_type: "resume"
                title: "Senior Python Developer - TechCorp Resume"
                content:
                  text: "John Doe\nSoftware Engineer\n\nPROFESSIONAL SUMMARY\n..."
                  html: "<html><body>..."
                metadata:
                  generation_id: "gen_789"
                  profile_id: "profile_456"
                  job_id: "job_123"
                  job_title: "Senior Python Developer"
                  company: "TechCorp Inc"
                  template: "modern"
                  ats_score: 0.87
                  match_percentage: 82
                  keyword_coverage: 0.91
                  tokens_used: 7850
                  generation_time: 28.5
                pdf:
                  url: "https://api.jobwise.ai/documents/doc_101/download"
                  size_bytes: 245678
                  page_count: 1
                version: 1
                created_at: "2024-10-18T10:31:28Z"
                updated_at: "2024-10-18T10:31:28Z"

    delete:
      tags:
        - Documents
      summary: Delete document
      description: Permanently delete generated document and PDF
      parameters:
        - $ref: '#/components/parameters/DocumentId'
      responses:
        '204':
          description: Document deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /documents/{document_id}/download:
    get:
      tags:
        - Documents
      summary: Download document PDF
      description: Download generated document as PDF file
      parameters:
        - $ref: '#/components/parameters/DocumentId'
      responses:
        '200':
          description: PDF file
          content:
            application/pdf:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              description: Attachment filename
              schema:
                type: string
                example: "attachment; filename=\"John_Doe_Resume_TechCorp.pdf\""
            Content-Length:
              description: File size in bytes
              schema:
                type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  # POST /documents is handled above at /documents path
    
    DocumentId:
      name: document_id
      in: path
      required: true
      description: Document unique identifier
      schema:
        type: string
        format: uuid

  responses:
    BadRequest:
      description: Invalid request data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "validation_error"
            message: "Invalid request data"
            details:
              - field: "email"
                message: "Invalid email format"
    
    Unauthorized:
      description: Authentication required or invalid credentials
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "unauthorized"
            message: "Invalid or missing authentication token"
    
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "not_found"
            message: "The requested resource was not found"
    
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "internal_error"
            message: "An unexpected error occurred"

  schemas:
    # System Schemas
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        dependencies:
          type: object
          properties:
            database:
              type: string
              enum: [connected, disconnected, error]
            redis:
              type: string
              enum: [connected, disconnected, error]
            openai:
              type: string
              enum: [available, unavailable, rate_limited]
      required: [status, timestamp, version]

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error code identifier
        message:
          type: string
          description: Human-readable error message
        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string
        request_id:
          type: string
          description: Unique request identifier for debugging
      required: [error, message]

    # Authentication Schemas
    UserRegisterRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        full_name:
          type: string
      required: [email, password, full_name]

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
      required: [email, password]

    RefreshRequest:
      type: object
      properties:
        refresh_token:
          type: string
      required: [refresh_token]

    TokenResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          default: "bearer"
        expires_in:
          type: integer
        user_id:
          type: string
      required: [access_token, refresh_token, expires_in, user_id]

    AuthResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          default: "Bearer"
        expires_in:
          type: integer
          description: Token expiration time in seconds
        user:
          $ref: '#/components/schemas/UserInfo'
      required: [access_token, token_type, expires_in]

    UserResponse:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        full_name:
          type: string
        is_active:
          type: boolean
        is_verified:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        last_login_at:
          type: string
          format: date-time
      required: [id, email, full_name]

    UserInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        full_name:
          type: string
        created_at:
          type: string
          format: date-time
      required: [id, email, full_name]

    # Profile Schemas
    PersonalInfo:
      type: object
      properties:
        full_name:
          type: string
          maxLength: 100
        email:
          type: string
          format: email
        phone:
          type: string
          pattern: '^[\+]?[1-9][\d\s\-\(\)]{7,15}$'
        location:
          type: string
          maxLength: 100
        linkedin:
          type: string
          format: uri
        github:
          type: string
          format: uri
        website:
          type: string
          format: uri
      required: [full_name, email]

    Experience:
      type: object
      properties:
        title:
          type: string
          maxLength: 100
        company:
          type: string
          maxLength: 100
        location:
          type: string
          maxLength: 100
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
          nullable: true
        is_current:
          type: boolean
          default: false
        description:
          type: string
          maxLength: 1000
        achievements:
          type: array
          items:
            type: string
            maxLength: 200
          maxItems: 10
      required: [title, company, start_date, description]

    Education:
      type: object
      properties:
        institution:
          type: string
          maxLength: 100
        degree:
          type: string
          maxLength: 100
        field_of_study:
          type: string
          maxLength: 100
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
          nullable: true
        gpa:
          type: number
          minimum: 0.0
          maximum: 4.0
        honors:
          type: array
          items:
            type: string
            maxLength: 100
      required: [institution, degree, field_of_study]

    Skills:
      type: object
      properties:
        technical:
          type: array
          items:
            type: string
            maxLength: 50
          maxItems: 50
        soft:
          type: array
          items:
            type: string
            maxLength: 50
          maxItems: 20
        languages:
          type: array
          items:
            $ref: '#/components/schemas/Language'
          maxItems: 10
        certifications:
          type: array
          items:
            $ref: '#/components/schemas/Certification'
          maxItems: 20

    Language:
      type: object
      properties:
        name:
          type: string
          maxLength: 50
        proficiency:
          type: string
          enum: [basic, conversational, fluent, native]
      required: [name, proficiency]

    Certification:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        issuer:
          type: string
          maxLength: 100
        date_obtained:
          type: string
          format: date
        expiry_date:
          type: string
          format: date
          nullable: true
        credential_id:
          type: string
          maxLength: 100
        verification_url:
          type: string
          format: uri
      required: [name, issuer, date_obtained]

    CreateProfileDTO:
      type: object
      properties:
        personal_info:
          $ref: '#/components/schemas/PersonalInfo'
        professional_summary:
          type: string
          maxLength: 1000
        experiences:
          type: array
          items:
            $ref: '#/components/schemas/Experience'
        education:
          type: array
          items:
            $ref: '#/components/schemas/Education'
        skills:
          $ref: '#/components/schemas/Skills'
        projects:
          type: array
          items:
            $ref: '#/components/schemas/Project'
      required: [personal_info]

    UpdateProfileDTO:
      type: object
      properties:
        personal_info:
          $ref: '#/components/schemas/PersonalInfo'
        professional_summary:
          type: string
          maxLength: 1000
        experiences:
          type: array
          items:
            $ref: '#/components/schemas/Experience'
        education:
          type: array
          items:
            $ref: '#/components/schemas/Education'
        skills:
          $ref: '#/components/schemas/Skills'
        projects:
          type: array
          items:
            $ref: '#/components/schemas/Project'

    Project:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
        description:
          type: string
          maxLength: 500
        technologies:
          type: array
          items:
            type: string
            maxLength: 50
        url:
          type: string
          format: uri
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
          nullable: true
      required: [name, description]

    ProfileUpdateRequest:
      allOf:
        - $ref: '#/components/schemas/ProfileCreateRequest'

    ProfileDTO:
      allOf:
        - $ref: '#/components/schemas/CreateProfileDTO'
        - type: object
          properties:
            id:
              type: string
              format: uuid
            user_id:
              type: string
              format: uuid
            version:
              type: integer
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time
          required: [id, user_id, version, created_at, updated_at]

    ProfileResponse:
      allOf:
        - $ref: '#/components/schemas/ProfileCreateRequest'
        - type: object
          properties:
            id:
              type: string
              format: uuid
            user_id:
              type: string
              format: uuid
            version:
              type: integer
              minimum: 1
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time
          required: [id, user_id, version, created_at, updated_at]

    ProfileListResponse:
      type: object
      properties:
        profiles:
          type: array
          items:
            $ref: '#/components/schemas/ProfileSummary'
        pagination:
          $ref: '#/components/schemas/Pagination'
      required: [profiles, pagination]

    ProfileSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        personal_info:
          type: object
          properties:
            full_name:
              type: string
            email:
              type: string
            location:
              type: string
        version:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required: [id, personal_info, version, created_at, updated_at]

    ProfileHistoryResponse:
      type: object
      properties:
        profile_id:
          type: string
          format: uuid
        versions:
          type: array
          items:
            $ref: '#/components/schemas/ProfileVersion'
        pagination:
          $ref: '#/components/schemas/Pagination'
      required: [profile_id, versions]

    ProfileVersion:
      type: object
      properties:
        version:
          type: integer
        changes:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              old_value:
                type: string
              new_value:
                type: string
        created_at:
          type: string
          format: date-time
        created_by:
          type: string
          description: User ID who made the change
      required: [version, changes, created_at]

    # Job Schemas
    SalaryRange:
      type: object
      properties:
        min:
          type: integer
          minimum: 0
        max:
          type: integer
          minimum: 0
        currency:
          type: string
          enum: [USD, EUR, GBP, CAD, AUD]
          default: USD
      required: [currency]

    JobDTO:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        company:
          type: string
        location:
          type: string
        job_type:
          type: string
        experience_level:
          type: string
        salary_range:
          $ref: '#/components/schemas/SalaryRange'
        description:
          type: string
        requirements:
          type: array
          items:
            type: string
        benefits:
          type: array
          items:
            type: string
        posted_date:
          type: string
          format: date-time
        application_deadline:
          type: string
          format: date-time
          nullable: true
        company_size:
          type: string
        industry:
          type: string
        remote_work_policy:
          type: string
        tags:
          type: array
          items:
            type: string
      required: [id, title, company, location, job_type, description, posted_date]

    JobResponse:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        company:
          type: string
        location:
          type: string
        remote:
          type: boolean
        job_type:
          type: string
          enum: [full_time, part_time, contract, freelance, internship]
        experience_level:
          type: string
          enum: [entry, mid, senior, lead, executive]
        salary_range:
          $ref: '#/components/schemas/SalaryRange'
        description:
          type: string
        requirements:
          type: array
          items:
            type: string
        benefits:
          type: array
          items:
            type: string
        application_url:
          type: string
          format: uri
        posted_date:
          type: string
          format: date-time
        expires_date:
          type: string
          format: date-time
          nullable: true
        source:
          type: string
          description: Data source (e.g., "indeed", "linkedin", "static")
      required: [id, title, company, location, job_type, description, posted_date]

    JobSearchResponseDTO:
      type: object
      properties:
        jobs:
          type: array
          items:
            $ref: '#/components/schemas/JobDTO'
        total_count:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
        has_more:
          type: boolean
      required: [jobs, total_count, limit, offset, has_more]

    JobSearchResponse:
      type: object
      properties:
        jobs:
          type: array
          items:
            $ref: '#/components/schemas/JobResponse'
        pagination:
          $ref: '#/components/schemas/Pagination'
        filters:
          type: object
          properties:
            applied_filters:
              type: object
            available_filters:
              type: object
              properties:
                locations:
                  type: array
                  items:
                    type: string
                companies:
                  type: array
                  items:
                    type: string
                experience_levels:
                  type: array
                  items:
                    type: string
      required: [jobs, pagination]

    # Saved Jobs
    SaveJobRequest:
      type: object
      properties:
        job_id:
          type: string
        notes:
          type: string
          maxLength: 1000
        status:
          type: string
          enum: [interested, applied, interviewing, offered, rejected, withdrawn]
          default: interested
      required: [job_id]

    UpdateSavedJobRequest:
      type: object
      properties:
        notes:
          type: string
          maxLength: 1000
        status:
          type: string
          enum: [interested, applied, interviewing, offered, rejected, withdrawn]
        applied_date:
          type: string
          format: date
          nullable: true

    SavedJobResponse:
      allOf:
        - $ref: '#/components/schemas/SaveJobRequest'
        - type: object
          properties:
            id:
              type: string
              format: uuid
            job:
              $ref: '#/components/schemas/JobResponse'
            applied_date:
              type: string
              format: date
              nullable: true
            created_at:
              type: string
              format: date-time
            updated_at:
              type: string
              format: date-time
          required: [id, job, created_at, updated_at]

    SavedJobListResponse:
      type: object
      properties:
        saved_jobs:
          type: array
          items:
            $ref: '#/components/schemas/SavedJobResponse'
        pagination:
          $ref: '#/components/schemas/Pagination'
        status_counts:
          type: object
          properties:
            interested:
              type: integer
            applied:
              type: integer
            interviewing:
              type: integer
            offered:
              type: integer
            rejected:
              type: integer
            withdrawn:
              type: integer
      required: [saved_jobs, pagination]

    # AI Generation Schemas
    GenerationOptions:
      type: object
      properties:
        template:
          type: string
          enum: [modern, classic, creative, minimal, ats_optimized]
          default: modern
        length:
          type: string
          enum: [one_page, two_page, comprehensive]
          default: one_page
        focus_areas:
          type: array
          items:
            type: string
          description: Areas to emphasize in generation
        include_cover_letter:
          type: boolean
          default: false
        custom_instructions:
          type: string
          maxLength: 500
          description: Additional instructions for AI generation

    ResumeGenerationRequest:
      type: object
      properties:
        profile_id:
          type: string
          format: uuid
        job_id:
          type: string
        options:
          $ref: '#/components/schemas/GenerationOptions'
      required: [profile_id, job_id]

    CoverLetterGenerationRequest:
      type: object
      properties:
        profile_id:
          type: string
          format: uuid
        job_id:
          type: string
        options:
          type: object
          properties:
            tone:
              type: string
              enum: [professional, enthusiastic, confident, humble]
              default: professional
            length:
              type: string
              enum: [short, standard, detailed]
              default: standard
            custom_instructions:
              type: string
              maxLength: 500
      required: [profile_id, job_id]

    GenerationProgress:
      type: object
      properties:
        current_stage:
          type: integer
          minimum: 0
          maximum: 2
        total_stages:
          type: integer
          default: 2
        percentage:
          type: integer
          minimum: 0
          maximum: 100
        stage_name:
          type: string
          enum: ["Job Analysis", "Profile Compilation", "Document Generation", "Quality Validation", "PDF Export"]
        stage_description:
          type: string
      required: [current_stage, total_stages, percentage]

    GenerationResult:
      type: object
      properties:
        document_id:
          type: string
          format: uuid
        ats_score:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: ATS compatibility score
        match_percentage:
          type: integer
          minimum: 0
          maximum: 100
          description: Profile-job match percentage
        keyword_coverage:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: Keyword coverage ratio
        pdf_url:
          type: string
          format: uri
          description: URL to download generated PDF
        recommendations:
          type: array
          items:
            type: string
          description: Suggestions for improvement

    GenerationResponse:
      type: object
      properties:
        generation_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, generating, completed, failed, cancelled]
        progress:
          $ref: '#/components/schemas/GenerationProgress'
        estimated_completion:
          type: string
          format: date-time
        profile_id:
          type: string
          format: uuid
        job_id:
          type: string
        created_at:
          type: string
          format: date-time
      required: [generation_id, status, progress, profile_id, job_id, created_at]

    GenerationStatusResponse:
      allOf:
        - $ref: '#/components/schemas/GenerationResponse'
        - type: object
          properties:
            result:
              $ref: '#/components/schemas/GenerationResult'
              nullable: true
            error_message:
              type: string
              nullable: true
            tokens_used:
              type: integer
              minimum: 0
            generation_time:
              type: number
              minimum: 0
              description: Total generation time in seconds
            updated_at:
              type: string
              format: date-time
            completed_at:
              type: string
              format: date-time
              nullable: true

    # Document Schemas
    DocumentContent:
      type: object
      properties:
        text:
          type: string
          description: Plain text content
        html:
          type: string
          description: HTML formatted content
        markdown:
          type: string
          description: Markdown formatted content
      required: [text]

    DocumentMetadata:
      type: object
      properties:
        generation_id:
          type: string
          format: uuid
        profile_id:
          type: string
          format: uuid
        job_id:
          type: string
        job_title:
          type: string
        company:
          type: string
        template:
          type: string
        ats_score:
          type: number
        match_percentage:
          type: integer
        keyword_coverage:
          type: number
        tokens_used:
          type: integer
        generation_time:
          type: number

    DocumentGenerationRequest:
      type: object
      properties:
        profile_id:
          type: string
          format: uuid
        job_id:
          type: string
        options:
          $ref: '#/components/schemas/GenerationOptions'
        include_cover_letter:
          type: boolean
          default: false
      required: [profile_id, job_id]

    PDFInfo:
      type: object
      properties:
        url:
          type: string
          format: uri
        size_bytes:
          type: integer
        page_count:
          type: integer
        created_at:
          type: string
          format: date-time
      required: [url, size_bytes, page_count]

    DocumentResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        document_type:
          type: string
          enum: [resume, cover_letter]
        title:
          type: string
        content:
          $ref: '#/components/schemas/DocumentContent'
        metadata:
          $ref: '#/components/schemas/DocumentMetadata'
        pdf:
          $ref: '#/components/schemas/PDFInfo'
        version:
          type: integer
          minimum: 1
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required: [id, document_type, title, content, version, created_at, updated_at]

    DocumentSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        document_type:
          type: string
          enum: [resume, cover_letter]
        title:
          type: string
        job_title:
          type: string
        company:
          type: string
        ats_score:
          type: number
          nullable: true
        created_at:
          type: string
          format: date-time
        pdf_url:
          type: string
          format: uri
      required: [id, document_type, title, created_at]

    DocumentListResponse:
      type: object
      properties:
        documents:
          type: array
          items:
            $ref: '#/components/schemas/DocumentSummary'
        pagination:
          $ref: '#/components/schemas/Pagination'
        statistics:
          type: object
          properties:
            total_documents:
              type: integer
            resumes:
              type: integer
            cover_letters:
              type: integer
            average_ats_score:
              type: number
      required: [documents, pagination]

    ShareDocumentRequest:
      type: object
      properties:
        expires_in_hours:
          type: integer
          minimum: 1
          maximum: 168
          default: 24
        password_protected:
          type: boolean
          default: false
        password:
          type: string
          minLength: 6
        download_limit:
          type: integer
          minimum: 1
          maximum: 100
          default: 10

    ShareLinkResponse:
      type: object
      properties:
        share_id:
          type: string
          format: uuid
        share_url:
          type: string
          format: uri
        expires_at:
          type: string
          format: date-time
        password_protected:
          type: boolean
        download_limit:
          type: integer
        downloads_remaining:
          type: integer
        created_at:
          type: string
          format: date-time
      required: [share_id, share_url, expires_at, created_at]

    # Common Schemas
    Pagination:
      type: object
      properties:
        total:
          type: integer
          minimum: 0
        limit:
          type: integer
          minimum: 1
        offset:
          type: integer
          minimum: 0
        has_next:
          type: boolean
        has_previous:
          type: boolean
      required: [total, limit, offset, has_next, has_previous]

# Tags for API organization
tags:
  - name: System
    description: Health check and system status endpoints
  - name: Authentication
    description: User authentication and authorization
  - name: Profiles
    description: Master resume profile management
  - name: Jobs
    description: Job discovery and browsing
  - name: Saved Jobs
    description: Job saving and application tracking
  - name: AI Generation
    description: AI-powered resume and cover letter generation (Priority Feature)
  - name: Documents
    description: Generated document management and sharing