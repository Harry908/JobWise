@startuml Universal Service Architecture
!define RECTANGLE class

title JobWise Service Architecture - Current Implementation Status (F1-F6 Complete)

package "Domain Abstractions (Ports)" {
    interface LLMServicePort {
        +generate_completion(request: LLMRequest): LLMResponse
        +estimate_tokens(text: str): TokenEstimate
        +get_model_capabilities(): ModelCapabilities
        +validate_response(response: LLMResponse): ValidationResult
        +get_rate_limits(): RateLimitInfo
        +calculate_cost(request: LLMRequest): CostEstimate
    }
    note right: ðŸš§ F7 Structure Ready\nInterface defined, adapters ready
    
    interface JobSearchServicePort {
        +search_jobs(criteria: JobSearchCriteria): JobSearchResult
        +get_job_details(job_id: str): JobDetails
        +get_trending_skills(): List[Skill]
        +get_salary_data(position: str, location: str): SalaryInfo
    }
    note right: âœ… F5 Complete\nStatic job implementation working
    
    interface PDFGeneratorPort {
        +generate_pdf(content: DocumentContent, template: PDFTemplate): PDFResult
        +get_available_templates(): List[PDFTemplate]
        +validate_content(content: DocumentContent): ValidationResult
        +optimize_layout(content: DocumentContent): LayoutOptimization
    }
    note right: ðŸš§ F8 Structure Ready\nExport system framework in place
    
    interface CacheServicePort {
        +get[T](key: str, type_: Type[T]): Optional[T]
        +set(key: str, value: Any, ttl: Optional[int]): bool
        +delete(key: str): bool
        +exists(key: str): bool
        +clear_pattern(pattern: str): int
        +get_stats(): CacheStats
    }
    note right: ðŸš§ Structure Ready\nRedis/Memory adapters prepared
}

package "Implemented Services (F1-F6 Complete)" {
    package "Authentication Services (F3 Complete)" {
        RECTANGLE AuthService {
            -jwt_handler: JWTHandler
            -password_hasher: PasswordHasher
            -user_repository: UserRepository
            --
            âœ… +register_user(email: str, password: str): UserResponse
            âœ… +authenticate_user(email: str, password: str): AuthResponse
            âœ… +refresh_token(refresh_token: str): TokenResponse
            âœ… +get_current_user(token: str): UserResponse
            âœ… +change_password(user_id: str, old_password: str, new_password: str): bool
            -hash_password(password: str): str
            -verify_password(plain: str, hashed: str): bool
            -create_tokens(user_id: str): TokenPair
        }
        note right: **F3 Complete**\n13/13 tests passing (100%)\nJWT + bcrypt working
    }
    
    package "Profile Services (F4 Complete)" {
        RECTANGLE ProfileService {
            -profile_repository: ProfileRepository
            -experience_repository: ExperienceRepository
            -education_repository: EducationRepository
            -skill_repository: SkillRepository
            --
            âœ… +create_profile(profile_data: ProfileCreateRequest): ProfileResponse
            âœ… +get_profile(profile_id: str): ProfileResponse
            âœ… +update_profile(profile_id: str, updates: ProfileUpdateRequest): ProfileResponse
            âœ… +delete_profile(profile_id: str): bool
            âœ… +add_experience(profile_id: str, experience: ExperienceRequest): ExperienceResponse
            âœ… +update_experience(profile_id: str, exp_id: str, updates: ExperienceRequest): ExperienceResponse
            âœ… +delete_experience(profile_id: str, exp_id: str): bool
            âœ… +get_profile_analytics(profile_id: str): ProfileAnalytics
            -validate_profile_ownership(user_id: str, profile_id: str): bool
        }
        note right: **F4 Complete**\nFull CRUD operations\nExperience/Education/Projects\nProfile analytics endpoints
    }
    
    package "Unified Job Services (F5 + F6 Complete)" {
        RECTANGLE JobService {
            -unified_job_repository: JobRepository
            -cache_service: CacheServicePort
            -search_engine: LocalSearchEngine
            -keyword_extractor: KeywordExtractor
            --
            âœ… +search_jobs(criteria: JobSearchCriteria, user_id: str?): JobSearchResult
            âœ… +get_job_details(job_id: str): JobDetails
            âœ… +create_user_job(user_id: str, job_data: JobCreateRequest): JobResponse
            âœ… +update_user_job(user_id: str, job_id: str, updates: JobUpdateRequest): JobResponse
            âœ… +delete_user_job(user_id: str, job_id: str): bool
            âœ… +list_user_jobs(user_id: str, filters: JobFilters): List[JobSummary]
            âœ… +get_job_filters(): AvailableFilters
            âœ… +get_job_statistics(): JobStatistics
            âœ… +seed_jobs_from_file(): bool
            âœ… +parse_job_keywords(job_id: str): KeywordAnalysis
            âœ… +change_job_status(job_id: str, status: JobStatus): bool
            -apply_search_filters(jobs: List[Job], criteria: JobSearchCriteria): List[Job]
            -calculate_match_score(job: Job, user_profile: Profile): float
            -extract_job_keywords(job_description: str): List[str]
            -validate_job_ownership(user_id: str, job_id: str): bool
        }
        note right: **F5 + F6 Unified Job Management Complete**\n\n**All Input Methods Supported:**\nâ€¢ API sourced jobs (external providers)\nâ€¢ Static JSON data (mock/seed data)\nâ€¢ User-created jobs (copy-paste conversion)\nâ€¢ Scraped jobs (web scraping)\nâ€¢ Imported jobs (bulk file import)\n\n**Features:**\nâ€¢ Unified search across all job sources\nâ€¢ Single JobModel entity (no duplication)\nâ€¢ Source-aware processing pipeline\nâ€¢ 6/6 tests passing for search/filtering\nâ€¢ Keyword extraction for all sources\nâ€¢ Status management for user jobs
        
        RECTANGLE StaticJobAdapter {
            -job_data: List[JobPosting]
            -search_index: SearchIndex
            --
            âœ… +search_jobs(criteria: JobSearchCriteria): JobSearchResult
            âœ… +get_job_details(job_id: str): JobDetails
            âœ… +load_static_data(): List[JobPosting]
            -build_search_index(): SearchIndex
            -simulate_realistic_latency(): void
        }
    }
    

}

package "AI Infrastructure (F7-F8 Structure Ready)" {
    package "Generation Services (F7 Structure Ready)" {
        RECTANGLE MockGenerationService {
            -llm_service: LLMServicePort
            -template_manager: TemplateManager
            -quality_validator: QualityValidator
            --
            ðŸš§ +generate_resume(profile: Profile, job: Job, options: GenerationOptions): GenerationResult
            ðŸš§ +get_generation_status(generation_id: str): GenerationStatus
            ðŸš§ +cancel_generation(generation_id: str): bool
            ðŸš§ +regenerate_document(generation_id: str, feedback: str): GenerationResult
            -simulate_ai_processing(stage: PipelineStage): ProcessingResult
            -apply_realistic_timing(): void
        }
        note right: **F7 Structure Ready**\n5-stage pipeline scaffolding\nMock AI responses prepared\nRealistic timing simulation
        
        RECTANGLE UniversalAIOrchestrator {
            -pipeline_stages: List[PipelineStage]
            -fallback_manager: FallbackManager
            -monitoring_service: MonitoringService
            --
            ðŸš§ +execute_pipeline(profile: Profile, job: Job): PipelineResult
            ðŸš§ +set_llm_provider(provider: LLMProvider): void
            ðŸš§ +get_pipeline_status(execution_id: str): PipelineStatus
            ðŸš§ +cancel_execution(execution_id: str): void
            -handle_stage_failure(stage: PipelineStage, error: Exception): FallbackResult
            -track_pipeline_metrics(): void
        }
    }
    
    package "Document Services (F8 Structure Ready)" {
        RECTANGLE DocumentService {
            -document_repository: DocumentRepository
            -pdf_generator: PDFGeneratorPort
            -storage_service: StorageServicePort
            --
            ðŸš§ +create_document(generation_result: GenerationResult): DocumentResponse
            ðŸš§ +get_document(document_id: str): DocumentResponse
            ðŸš§ +delete_document(document_id: str): bool
            ðŸš§ +list_documents(user_id: str, filters: DocumentFilters): List[DocumentSummary]
            ðŸš§ +export_document(document_id: str, format: ExportFormat): ExportResult
            ðŸš§ +generate_share_link(document_id: str, options: ShareOptions): ShareLink
            -validate_document_ownership(user_id: str, document_id: str): bool
        }
        note right: **F8 Structure Ready**\nDocument storage entity\nPDF generation framework\nExport system prepared
        
        RECTANGLE TextExporter {
            -template_engine: TextTemplateEngine
            -formatting_rules: FormattingRules
            --
            ðŸš§ +export_to_text(document: Document): TextExportResult
            ðŸš§ +apply_formatting(content: DocumentContent): FormattedText
            ðŸš§ +generate_filename(document: Document): str
            -clean_text_formatting(content: str): str
            -optimize_line_breaks(): void
        }
    }
}

package "Database Layer (F2 Complete)" {
    RECTANGLE UserRepository {
        -session: AsyncSession
        --
        âœ… +create_user(user_data: Dict): UserModel
        âœ… +get_user_by_id(user_id: str): Optional[UserModel]
        âœ… +get_user_by_email(email: str): Optional[UserModel]
        âœ… +update_user(user_id: str, updates: Dict): UserModel
        âœ… +delete_user(user_id: str): bool
        âœ… +is_email_taken(email: str): bool
        -handle_database_errors(): void
    }
    
    RECTANGLE ProfileRepository {
        -session: AsyncSession
        --
        âœ… +create_profile(profile_data: Dict): MasterProfileModel
        âœ… +get_profile_by_id(profile_id: str): Optional[MasterProfileModel]
        âœ… +get_profiles_by_user(user_id: str): List[MasterProfileModel]
        âœ… +update_profile(profile_id: str, updates: Dict): MasterProfileModel
        âœ… +delete_profile(profile_id: str): bool
        âœ… +get_profile_with_relations(profile_id: str): MasterProfileModel
        -load_related_entities(profile: MasterProfileModel): void
    }
    
    RECTANGLE JobRepository {
        -session: AsyncSession
        --
        âœ… +search_jobs(criteria: JobSearchCriteria, user_id: str?): List[JobModel]
        âœ… +get_job_by_id(job_id: str): Optional[JobModel]
        âœ… +create_job(job_data: Dict): JobModel
        âœ… +update_job(job_id: str, updates: Dict): JobModel
        âœ… +delete_job(job_id: str): bool
        âœ… +get_user_jobs(user_id: str, filters: Dict): List[JobModel]
        âœ… +count_jobs(criteria: JobSearchCriteria): int
        âœ… +get_available_filters(): AvailableFilters
        âœ… +bulk_insert_jobs(jobs: List[Dict]): int
        -apply_pagination(query: Query, limit: int, offset: int): Query
        -filter_by_source(query: Query, source: JobSource): Query
        -validate_user_ownership(user_id: str, job_id: str): bool
    }
}

' Implementation status relationships
AuthService --> UserRepository : "âœ… Working"
ProfileService --> ProfileRepository : "âœ… Working"
ProfileService --> UserRepository : "âœ… Working"
JobService --> JobRepository : "âœ… Working (unified)"
JobService --> StaticJobAdapter : "âœ… Working"
JobService --> UserRepository : "âœ… Working"

MockGenerationService --> LLMServicePort : "ðŸš§ Structure ready"
DocumentService --> PDFGeneratorPort : "ðŸš§ Structure ready"
DocumentService --> CacheServicePort : "ðŸš§ Structure ready"

' Current implementation status
note top of AuthService
**F3 Authentication Complete**
âœ… JWT token management working
âœ… User registration/login endpoints
âœ… Password security with bcrypt
âœ… 13/13 tests passing (100% success rate)
âœ… Middleware protection active
âœ… Token refresh working
end note

note top of ProfileService
**F4 Profile Management Complete**
âœ… Master profile CRUD operations
âœ… Experience/education/project management
âœ… Profile analytics endpoints
âœ… Comprehensive value objects implemented
âœ… Repository pattern with async support
âœ… Full validation and error handling
end note

note top of JobService
**F5 + F6 Unified Job Management Complete**
âœ… Unified JobModel supporting all input methods:
  â€¢ API sourced jobs (external_job_id tracking)
  â€¢ Static JSON data (100+ mock jobs for development)
  â€¢ User-created jobs (copy-paste with JSON template)
  â€¢ Scraped jobs (web scraping framework ready)
  â€¢ Imported jobs (bulk file import support)
  
âœ… Features working across all job sources:
  â€¢ Search and filtering endpoints (6/6 tests passing)
  â€¢ Keyword extraction and analysis
  â€¢ Status management (active/draft/archived/expired)
  â€¢ User ownership validation for user-created jobs
  â€¢ Performance optimized with caching
  â€¢ Single API endpoints handling all job types
  
âœ… Benefits achieved:
  â€¢ Eliminated model duplication (JobModel vs JobDescriptionModel)
  â€¢ Simplified database schema and relationships
  â€¢ Unified search across all job sources
  â€¢ Reduced code complexity and maintenance overhead
  â€¢ Consistent job processing pipeline
end note

note top of MockGenerationService
**F7 Mock AI Pipeline Structure Ready**
ðŸš§ 5-stage pipeline scaffolding complete
ðŸš§ Generation entity models in place
ðŸš§ Mock AI service framework ready
ðŸš§ Realistic response time simulation
ðŸš§ Universal LLM adapter pattern prepared
ðŸš§ Ready for mock implementation
end note

note top of DocumentService
**F8 Export System Structure Ready**
ðŸš§ Document storage entity defined
ðŸš§ PDF generation adapter framework
ðŸš§ File management support ready
ðŸš§ Export system architecture in place
ðŸš§ Text file export (.txt) structure ready
ðŸš§ Download endpoints framework prepared
end note

@enduml

package "Service Adapters (Implementations)" {
    package "LLM Adapters" {
        RECTANGLE OpenAIAdapter {
            -client: OpenAIClient
            -model_configs: Dict[str, ModelConfig]
            -rate_limiter: RateLimiter
            --
            +generate_completion(request: LLMRequest): LLMResponse
            +estimate_tokens(text: str): TokenEstimate
            -map_to_openai_format(request: LLMRequest): OpenAIRequest
            -parse_openai_response(response: OpenAIResponse): LLMResponse
            -handle_rate_limits(): void
            -retry_with_backoff(operation: Callable): Any
        }
        
        RECTANGLE ClaudeAdapter {
            -client: AnthropicClient
            -model_configs: Dict[str, ModelConfig]
            -token_manager: TokenManager
            --
            +generate_completion(request: LLMRequest): LLMResponse
            +estimate_tokens(text: str): TokenEstimate
            -map_to_claude_format(request: LLMRequest): ClaudeRequest
            -parse_claude_response(response: ClaudeResponse): LLMResponse
            -handle_claude_specific_limits(): void
        }
        
        RECTANGLE GeminiAdapter {
            -client: GoogleGenAIClient
            -safety_settings: SafetySettings
            --
            +generate_completion(request: LLMRequest): LLMResponse
            +estimate_tokens(text: str): TokenEstimate
            -map_to_gemini_format(request: LLMRequest): GeminiRequest
            -configure_safety_settings(): SafetySettings
            -handle_content_filtering(): ContentFilterResult
        }
        
        RECTANGLE GroqAdapter {
            -client: GroqClient
            -model_configs: Dict[str, ModelConfig]
            -speed_optimizer: SpeedOptimizer
            --
            +generate_completion(request: LLMRequest): LLMResponse
            +estimate_tokens(text: str): TokenEstimate
            -map_to_groq_format(request: LLMRequest): GroqRequest
            -parse_groq_response(response: GroqResponse): LLMResponse
            -optimize_for_speed(): SpeedConfig
            -handle_high_throughput(): ThroughputConfig
        }
        
        RECTANGLE LocalLLMAdapter {
            -model_path: str
            -inference_engine: InferenceEngine
            -model_loader: ModelLoader
            --
            +generate_completion(request: LLMRequest): LLMResponse
            +estimate_tokens(text: str): TokenEstimate
            -load_local_model(): Model
            -optimize_inference_params(): InferenceParams
            -handle_resource_constraints(): ResourceAllocation
        }
    }
    
    package "Job Search Adapters" {
        RECTANGLE IndeedAdapter {
            -api_client: IndeedAPIClient
            -search_transformer: SearchTransformer
            --
            +search_jobs(criteria: JobSearchCriteria): JobSearchResult
            +get_job_details(job_id: str): JobDetails
            -transform_search_criteria(criteria: JobSearchCriteria): IndeedQuery
            -parse_indeed_response(response: IndeedResponse): JobSearchResult
            -handle_api_limits(): void
        }
        
        RECTANGLE LinkedInAdapter {
            -api_client: LinkedInAPIClient
            -oauth_handler: OAuthHandler
            --
            +search_jobs(criteria: JobSearchCriteria): JobSearchResult
            +get_job_details(job_id: str): JobDetails
            -authenticate_user(): AuthToken
            -transform_linkedin_data(data: LinkedInJobData): JobDetails
            -handle_rate_limiting(): void
        }
        
        RECTANGLE MockJobAdapter {
            -sample_data: List[JobPosting]
            -search_engine: LocalSearchEngine
            --
            +search_jobs(criteria: JobSearchCriteria): JobSearchResult
            +get_job_details(job_id: str): JobDetails
            -generate_realistic_data(): List[JobPosting]
            -simulate_search_latency(): void
        }
    }
    
    package "PDF Generator Adapters" {
        RECTANGLE ReportLabAdapter {
            -template_engine: ReportLabEngine
            -style_manager: StyleManager
            --
            +generate_pdf(content: DocumentContent, template: PDFTemplate): PDFResult
            +get_available_templates(): List[PDFTemplate]
            -apply_reportlab_styling(content: DocumentContent): StyledContent
            -optimize_page_layout(): LayoutResult
        }
        
        RECTANGLE WeasyPrintAdapter {
            -html_engine: WeasyPrintEngine
            -css_processor: CSSProcessor
            --
            +generate_pdf(content: DocumentContent, template: PDFTemplate): PDFResult
            -convert_to_html(content: DocumentContent): HTMLContent
            -apply_css_styling(html: HTMLContent): StyledHTML
        }
        
        RECTANGLE CloudPDFAdapter {
            -api_client: CloudPDFClient
            -template_manager: CloudTemplateManager
            --
            +generate_pdf(content: DocumentContent, template: PDFTemplate): PDFResult
            -upload_content(content: DocumentContent): ContentReference
            -download_generated_pdf(): bytes
        }
    }
    
    package "Cache Adapters" {
        RECTANGLE RedisAdapter {
            -redis_client: RedisClient
            -serializer: Serializer
            --
            +get[T](key: str, type_: Type[T]): Optional[T]
            +set(key: str, value: Any, ttl: Optional[int]): bool
            -serialize_value(value: Any): bytes
            -deserialize_value(data: bytes, type_: Type[T]): T
        }
        
        RECTANGLE MemoryAdapter {
            -cache_store: Dict[str, CacheEntry]
            -eviction_policy: EvictionPolicy
            --
            +get[T](key: str, type_: Type[T]): Optional[T]
            +set(key: str, value: Any, ttl: Optional[int]): bool
            -cleanup_expired_entries(): void
            -apply_eviction_policy(): void
        }
    }
    
    package "Storage Adapters" {
        RECTANGLE S3Adapter {
            -s3_client: S3Client
            -bucket_name: str
            --
            +upload_file(file_data: bytes, metadata: FileMetadata): FileReference
            +download_file(file_id: str): bytes
            -generate_presigned_url(file_id: str): str
            -handle_multipart_upload(): UploadResult
        }
        
        RECTANGLE AzureBlobAdapter {
            -blob_client: BlobServiceClient
            -container_name: str
            --
            +upload_file(file_data: bytes, metadata: FileMetadata): FileReference
            +download_file(file_id: str): bytes
            -configure_access_policies(): AccessPolicy
            -handle_blob_metadata(): BlobMetadata
        }
        
        RECTANGLE LocalFileAdapter {
            -storage_path: str
            -file_manager: FileManager
            --
            +upload_file(file_data: bytes, metadata: FileMetadata): FileReference
            +download_file(file_id: str): bytes
            -ensure_directory_structure(): void
            -cleanup_temp_files(): void
        }
    }
}

package "Service Factory & Configuration" {
    RECTANGLE ServiceFactory {
        -config: ServiceConfiguration
        -registry: ServiceRegistry
        --
        +create_llm_service(provider: LLMProvider): LLMServicePort
        +create_job_service(provider: JobProvider): JobSearchServicePort
        +create_pdf_service(provider: PDFProvider): PDFGeneratorPort
        +create_cache_service(provider: CacheProvider): CacheServicePort
        +create_storage_service(provider: StorageProvider): StorageServicePort
        +create_monitoring_service(provider: MonitoringProvider): MonitoringServicePort
        -validate_configuration(config: ProviderConfig): ValidationResult
        -initialize_adapter(adapter_class: Type, config: Dict): Any
    }
    
    RECTANGLE ServiceConfiguration {
        -llm_provider: LLMProvider
        -job_provider: JobProvider
        -pdf_provider: PDFProvider
        -cache_provider: CacheProvider
        -storage_provider: StorageProvider
        -monitoring_provider: MonitoringProvider
        -fallback_providers: Dict[str, List[str]]
        -feature_flags: Dict[str, bool]
        --
        +get_provider_config(service_type: str): ProviderConfig
        +get_fallback_chain(service_type: str): List[str]
        +is_feature_enabled(feature: str): bool
        +validate_configuration(): ValidationResult
    }
    
    enum LLMProvider {
        OPENAI_GPT3_5
        OPENAI_GPT4
        CLAUDE_SONNET
        CLAUDE_HAIKU
        GEMINI_PRO
        GEMINI_FLASH
        GROQ_LLAMA3_70B
        GROQ_LLAMA3_8B
        GROQ_MIXTRAL_8X7B
        GROQ_GEMMA_7B
        LOCAL_LLAMA
        LOCAL_MISTRAL
        AZURE_OPENAI
    }
    
    enum JobProvider {
        INDEED_API
        LINKEDIN_API
        GLASSDOOR_API
        MOCK_DATA
        STATIC_JSON
    }
    
    enum PDFProvider {
        REPORTLAB
        WEASYPRINT
        CLOUD_PDF_API
        PUPPETEER
        LATEX
    }
    
    enum CacheProvider {
        REDIS
        MEMORY_CACHE
        MEMCACHED
        DYNAMODB
    }
    
    enum StorageProvider {
        AWS_S3
        AZURE_BLOB
        GOOGLE_CLOUD
        LOCAL_FILE
        MINIO
    }
}

package "Universal AI Orchestrator" {
    RECTANGLE UniversalAIOrchestrator {
        -llm_service: LLMServicePort
        -cache_service: CacheServicePort
        -storage_service: StorageServicePort
        -monitoring_service: MonitoringServicePort
        -pipeline_stages: List[PipelineStage]
        -fallback_manager: FallbackManager
        -circuit_breaker: CircuitBreaker
        --
        +execute_pipeline(profile: MasterProfile, job: JobPosting): PipelineResult
        +set_llm_provider(provider: LLMProvider): void
        +get_pipeline_status(execution_id: UUID): PipelineStatus
        +cancel_execution(execution_id: UUID): void
        -handle_provider_failure(error: Exception): FallbackResult
        -switch_to_fallback_provider(): void
        -monitor_pipeline_performance(): void
    }
    
    RECTANGLE FallbackManager {
        -fallback_chains: Dict[str, List[ServiceAdapter]]
        -health_checker: HealthChecker
        -circuit_breakers: Dict[str, CircuitBreaker]
        --
        +get_next_provider(service_type: str, failed_provider: str): Optional[ServiceAdapter]
        +mark_provider_unhealthy(service_type: str, provider: str): void
        +check_provider_recovery(service_type: str, provider: str): bool
        +get_fallback_statistics(): FallbackStats
        -evaluate_provider_health(): HealthStatus
        -reset_circuit_breaker(service_type: str): void
    }
    
    RECTANGLE CircuitBreaker {
        -failure_threshold: int
        -timeout_duration: int
        -state: CircuitState
        -failure_count: int
        -last_failure_time: datetime
        --
        +call[T](operation: Callable[[], T]): T
        +get_state(): CircuitState
        +reset(): void
        +force_open(): void
        +force_close(): void
        -should_attempt_call(): bool
        -on_success(): void
        -on_failure(): void
    }
    
    enum CircuitState {
        CLOSED
        OPEN
        HALF_OPEN
    }
}

package "Common Value Objects" {
    RECTANGLE LLMRequest {
        -prompt: str
        -max_tokens: int
        -temperature: float
        -model: str
        -system_message: Optional[str]
        -response_format: ResponseFormat
        -metadata: Dict[str, Any]
        --
        +validate(): ValidationResult
        +estimate_cost(): CostEstimate
        +to_dict(): Dict[str, Any]
    }
    
    RECTANGLE LLMResponse {
        -content: str
        -tokens_used: TokenUsage
        -model_used: str
        -finish_reason: FinishReason
        -cost: float
        -latency_ms: int
        -metadata: Dict[str, Any]
        --
        +is_complete(): bool
        +get_quality_score(): float
        +to_dict(): Dict[str, Any]
    }
    
    RECTANGLE TokenUsage {
        -prompt_tokens: int
        -completion_tokens: int
        -total_tokens: int
        --
        +calculate_cost(model: str, provider: str): float
        +to_dict(): Dict[str, int]
    }
    
    RECTANGLE ServiceHealth {
        -service_type: str
        -provider: str
        -is_healthy: bool
        -response_time_ms: float
        -error_rate: float
        -last_check: datetime
        -details: Dict[str, Any]
        --
        +is_degraded(): bool
        +needs_attention(): bool
        +to_dict(): Dict[str, Any]
    }
}

' Implement relationships
LLMServicePort <|.. OpenAIAdapter
LLMServicePort <|.. ClaudeAdapter
LLMServicePort <|.. GeminiAdapter
LLMServicePort <|.. GroqAdapter
LLMServicePort <|.. LocalLLMAdapter

JobSearchServicePort <|.. IndeedAdapter
JobSearchServicePort <|.. LinkedInAdapter
JobSearchServicePort <|.. MockJobAdapter

PDFGeneratorPort <|.. ReportLabAdapter
PDFGeneratorPort <|.. WeasyPrintAdapter
PDFGeneratorPort <|.. CloudPDFAdapter

CacheServicePort <|.. RedisAdapter
CacheServicePort <|.. MemoryAdapter

StorageServicePort <|.. S3Adapter
StorageServicePort <|.. AzureBlobAdapter
StorageServicePort <|.. LocalFileAdapter

' Factory relationships
ServiceFactory --> ServiceConfiguration
ServiceFactory ..> LLMServicePort : creates
ServiceFactory ..> JobSearchServicePort : creates
ServiceFactory ..> PDFGeneratorPort : creates
ServiceFactory ..> CacheServicePort : creates
ServiceFactory ..> StorageServicePort : creates

' Orchestrator dependencies
UniversalAIOrchestrator --> LLMServicePort : uses
UniversalAIOrchestrator --> CacheServicePort : uses
UniversalAIOrchestrator --> StorageServicePort : uses
UniversalAIOrchestrator --> MonitoringServicePort : uses
UniversalAIOrchestrator --> FallbackManager : manages
UniversalAIOrchestrator --> CircuitBreaker : monitors

' Value object usage
OpenAIAdapter --> LLMRequest : consumes
OpenAIAdapter --> LLMResponse : produces
ClaudeAdapter --> LLMRequest : consumes
ClaudeAdapter --> LLMResponse : produces
GeminiAdapter --> LLMRequest : consumes
GeminiAdapter --> LLMResponse : produces
GroqAdapter --> LLMRequest : consumes
GroqAdapter --> LLMResponse : produces

FallbackManager --> ServiceHealth : monitors
CircuitBreaker --> ServiceHealth : evaluates

note top of ServiceFactory
Universal service factory that creates
appropriate adapters based on configuration:
- Environment-specific providers
- Runtime provider switching
- Fallback chain management
- Health monitoring integration
end note

note bottom of UniversalAIOrchestrator
Provider-agnostic AI orchestrator:
- Supports any LLM provider via adapters
- Automatic fallback on provider failures
- Circuit breaker pattern for resilience
- Real-time provider health monitoring
- Cost optimization across providers
end note

note right of FallbackManager
Intelligent fallback management:
- Multiple fallback chains per service
- Health-based provider selection
- Automatic recovery detection
- Performance-based routing
- Cost-aware provider switching
end note

@enduml